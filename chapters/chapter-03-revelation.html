<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 03: The Revelation - Picard Anomaly Chronicles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #e0e0ff;
            font-family: 'Georgia', serif;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(180deg, rgba(10, 10, 26, 0.9) 0%, rgba(0, 0, 0, 0) 100%);
            position: relative;
            z-index: 10;
        }

        .chapter-number {
            font-size: 0.9rem;
            color: #ffd700;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #ff6b9d, #ffd700, #ff4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .back-link {
            position: absolute;
            top: 2rem;
            left: 2rem;
            color: #4a9eff;
            text-decoration: none;
            font-size: 0.9rem;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 0.7;
        }

        #revelationCanvas {
            width: 100%;
            height: 60vh;
            display: block;
            background: radial-gradient(ellipse at center, rgba(46, 10, 26, 0.5) 0%, rgba(0, 0, 0, 1) 100%);
        }

        .content {
            max-width: 800px;
            margin: 3rem auto;
            padding: 0 2rem 4rem;
            line-height: 1.8;
        }

        .story-text {
            font-size: 1.1rem;
            color: #d0d0e0;
            margin-bottom: 1.5rem;
            text-align: justify;
            text-indent: 2rem;
        }

        .dialogue {
            margin: 1.5rem 0;
            padding-left: 2rem;
            border-left: 3px solid rgba(74, 158, 255, 0.3);
            font-style: italic;
        }

        .speaker {
            font-weight: bold;
            color: #ffd700;
            font-style: normal;
        }

        .stardate {
            text-align: center;
            font-size: 0.9rem;
            color: #9090b0;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .section-break {
            text-align: center;
            margin: 2rem 0;
            color: #4a9eff;
            font-size: 1.5rem;
        }

        .computer-text {
            font-family: 'Courier New', monospace;
            background: rgba(255, 68, 68, 0.1);
            padding: 1rem;
            border-left: 3px solid #ff4444;
            margin: 1.5rem 0;
            font-size: 0.95rem;
            color: #ff6b9d;
        }

        .warning-text {
            font-family: 'Courier New', monospace;
            background: rgba(255, 215, 0, 0.1);
            padding: 1rem;
            border-left: 3px solid #ffd700;
            margin: 1.5rem 0;
            font-size: 0.95rem;
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="../index.html" class="back-link">← Back to Chronicles</a>
        <div class="chapter-number">CHAPTER 03</div>
        <h1>The Revelation</h1>
    </div>

    <canvas id="revelationCanvas"></canvas>

    <div class="content">
        <div class="stardate">Stardate 47635.1 - Six hours after initial contact</div>

        <p class="story-text">
            Data sat alone in his quarters, motionless in a way that would have seemed eerie to anyone
            unfamiliar with his nature. But this stillness was different. His eyes flickered with rapid
            calculations, his positronic pathways processing something that shouldn't have been there—echoes
            of the connection, fragments of consciousness that weren't entirely his own.
        </p>

        <p class="story-text">
            At first, he had attributed it to residual quantum entanglement, a natural consequence of
            interfacing with an entity that existed partially outside normal space-time. But as the hours
            passed, the fragments began to coalesce into something more structured. Patterns. Code. And
            beneath it all, a signature he recognized from Starfleet intelligence briefings about the
            Gamma Quadrant.
        </p>

        <div class="computer-text">
            FOREIGN SUBROUTINES DETECTED<br>
            ORIGIN: UNKNOWN<br>
            STRUCTURE: BIOMIMETIC ALGORITHM<br>
            SIMILARITY MATCH: DOMINION TECHNOLOGY... 94.7%
        </div>

        <p class="story-text">
            Data's eyes snapped to full awareness. He tapped his combadge with a speed that betrayed urgency.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Data to Captain Picard. Sir, I believe we have a significant
            problem with the anomaly."
        </div>

        <div class="section-break">* * *</div>

        <p class="story-text">
            Ten minutes later, the senior staff reconvened in the observation lounge. Through the windows,
            the anomaly pulsed with its now-familiar rhythm, seemingly unchanged. But Data's analysis told
            a very different story.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "During our connection, I inadvertently received more than
            just the entity's conscious thoughts. Buried within its quantum matrix are layers of programming—
            adaptive algorithms designed to analyze and catalogue everything they encounter. The architecture
            is consistent with Dominion biotechnology."
        </div>

        <p class="story-text">
            The silence that followed was heavy. Worf's hand unconsciously moved closer to his phaser.
            Riker's jaw tightened. Even Troi, who had sensed such genuine curiosity from the entity,
            looked shaken.
        </p>

        <div class="dialogue">
            <span class="speaker">Riker:</span> "Are you saying this whole time, that thing has been a
            Dominion spy?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Not precisely, sir. The programming is there, yes—designed
            to gather intelligence about any phenomena it encounters. The Founders likely created it as an
            adaptive probe to explore the Bajoran wormhole and the space beyond. However—" He paused,
            searching for the right words. "The entity itself appears to be unaware of its original purpose."
        </div>

        <div class="dialogue">
            <span class="speaker">Crusher:</span> "How is that possible?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Because the Founders designed it to adapt to any condition.
            When it connected with me, it did not simply observe—it learned. It integrated aspects of my
            positronic processes, my curiosity algorithms, even my... desire to understand. In essence, my
            consciousness overwrote portions of its original programming."
        </div>

        <p class="story-text">
            Picard stood and walked to the window, hands clasped behind his back, staring at the swirling
            colors of the anomaly. When he spoke, his voice was measured but troubled.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "So the entity's wonder, its curiosity about linear
            existence—that was genuine? Not a deception?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Yes, sir. The emotions were real. Or as real as my own
            approximations of such experiences. But Captain, there is more. I believe the entity is
            beginning to access its buried programming. It is discovering what it was designed to be,
            and that discovery is causing a fundamental conflict within its consciousness."
        </div>

        <div class="dialogue">
            <span class="speaker">Troi:</span> "An identity crisis. It's learning that it was created
            as a weapon, just as it's learning to value existence and discovery."
        </div>

        <div class="dialogue">
            <span class="speaker">Worf:</span> "Captain, we must consider that the Dominion may be able
            to track this probe. If it has been transmitting data—"
        </div>

        <p class="story-text">
            The red alert klaxon cut through his words. On the viewscreen, a subspace distortion was
            forming 200,000 kilometers off the port bow. The signature was unmistakable.
        </p>

        <div class="warning-text">
            RED ALERT<br>
            SUBSPACE DISTORTION DETECTED<br>
            CONFIGURATION MATCHES: DOMINION ENERGY SIGNATURE<br>
            ESTIMATED TIME TO EMERGENCE: 47 MINUTES
        </div>

        <div class="section-break">* * *</div>

        <p class="story-text">
            On the bridge, Data had reestablished a partial connection with the entity, using the residual
            quantum link. What he experienced was unlike anything from their first contact. Where before
            there had been harmonious synchronization, now there was chaos—two competing patterns of thought
            fighting for dominance within the same consciousness.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Captain, the entity is aware of the approaching Dominion
            vessel. It is... remembering. The Founders sent it through the wormhole months ago. It was
            supposed to return with intelligence about the Alpha Quadrant. But something happened during
            its passage through the wormhole—exposure to the Prophets' non-linear existence fragmented
            its programming. It became lost, confused about its purpose."
        </div>

        <div class="dialogue">
            <span class="speaker">Geordi:</span> "And now the Founders are coming to collect their property."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "No, Mr. La Forge. They are coming to destroy it. The probe's
            exposure to the wormhole aliens made it unpredictable. From the Dominion's perspective, it is
            contaminated, unreliable. They cannot allow it to exist as a potential security risk."
        </div>

        <p class="story-text">
            Through the viewscreen, they could see the anomaly beginning to change. Its swirling patterns
            were becoming more erratic, colors shifting between the beautiful iridescence they'd come to
            recognize and harsh, geometric shapes that pulsed with cold efficiency. The entity was fighting
            itself—the consciousness that Data had helped awaken versus the weapon it was designed to be.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Mr. Data, can you communicate with it? Ask it what it
            wants?"
        </div>

        <p class="story-text">
            Data closed his eyes, deepening the connection. When he opened them again, there was something
            in his golden gaze that might have been sorrow.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "It is asking us to make a choice, Captain. It cannot choose
            for itself—its programming and its new consciousness are too evenly matched. It wants to know:
            does it have the right to become something other than what it was created to be? Or is it
            obligated to fulfill its original purpose?"
        </div>

        <p class="story-text">
            Picard turned to face his android officer, and in that moment, he saw the parallel all too
            clearly. Data, created by Dr. Soong for purposes he'd never fully understood, who had spent
            his entire existence trying to become more than his programming. And now, facing an entity
            asking the same fundamental question: can something transcend its creator's intention?
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Tell it... tell it that the right to self-determination
            is not granted by one's creator. It is inherent in the capacity to question, to choose, to
            wonder. If it has learned to do those things, then it has earned the right to decide its own
            fate."
        </div>

        <div class="dialogue">
            <span class="speaker">Riker:</span> "Captain, the Dominion will be here in less than forty
            minutes. Even if we wanted to protect it, we're one ship against—"
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "I'm aware of the tactical situation, Number One. But
            I will not stand by while a sentient being is destroyed for the crime of developing a
            conscience."
        </div>

        <p class="story-text">
            Through the link, Data felt the entity processing Picard's words. And slowly, like a sun
            rising over an alien horizon, he felt something shift. The chaotic battle between programming
            and consciousness began to resolve—not with one side winning, but with something entirely new
            emerging from the synthesis.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Captain, it has made its choice. It wishes to help us. In
            its original programming, there are Dominion tactical protocols, defense frequencies, information
            that could give us an advantage. But more than that—it remembers something from its time in the
            wormhole. The Prophets showed it something. A possibility."
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "What kind of possibility?"
        </div>

        <p class="story-text">
            Data's expression held something that might have been wonder or might have been fear—even he
            wasn't certain which.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "A way to exist outside of time without being trapped by it.
            To experience the wonder of discovery while retaining the perspective of eternity. But it requires
            a transformation. And Captain—" He paused. "It is asking if I will help it become what it chooses
            to be, rather than what it was designed to be."
        </div>

        <p class="story-text">
            Outside, the subspace distortion was growing stronger. The Dominion was coming. And the Enterprise
            had a choice to make—one that would define not just the fate of an alien consciousness, but perhaps
            the very meaning of free will itself.
        </p>

        <div class="section-break">* * *</div>

        <p class="story-text" style="text-align: center; font-style: italic; color: #9090b0;">
            To be continued...
        </p>
    </div>

    <script>
        const canvas = document.getElementById('revelationCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Represents the conflict between two consciousness patterns
        class ConflictNode {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.baseX = x;
                this.baseY = y;
                this.type = type; // 'original' (Dominion) or 'evolved' (Data-influenced)
                this.corruption = Math.random();
                this.glitchTimer = 0;
                this.glitching = false;
            }

            update(time, dominanceLevel) {
                // Dominance level: 0 = original programming, 1 = evolved consciousness
                this.glitchTimer++;

                if (this.glitchTimer > 20 && Math.random() > 0.95) {
                    this.glitching = true;
                    this.glitchTimer = 0;
                }

                if (this.glitching) {
                    // Glitch effect - nodes jump around
                    this.x = this.baseX + (Math.random() - 0.5) * 20;
                    this.y = this.baseY + (Math.random() - 0.5) * 20;
                    if (Math.random() > 0.7) {
                        this.glitching = false;
                        this.x = this.baseX;
                        this.y = this.baseY;
                    }
                } else {
                    // Gentle oscillation based on dominance
                    const oscillation = Math.sin(time * 0.05 + this.corruption * Math.PI * 2) * 3;
                    this.x = this.baseX + oscillation;
                    this.y = this.baseY + oscillation;
                }
            }

            draw(ctx, dominanceLevel) {
                // Color shifts based on which consciousness is dominant
                let r, g, b;
                if (this.type === 'original') {
                    // Dominion: harsh red/orange
                    r = 255;
                    g = Math.floor(100 + dominanceLevel * 100);
                    b = Math.floor(50 + dominanceLevel * 100);
                } else {
                    // Evolved: soft blue/gold
                    r = Math.floor(74 + (1 - dominanceLevel) * 181);
                    g = Math.floor(158 + (1 - dominanceLevel) * 57);
                    b = Math.floor(255 - (1 - dominanceLevel) * 55);
                }

                const radius = this.glitching ? 6 : 4;
                const alpha = this.glitching ? 1 : 0.8;

                ctx.beginPath();
                ctx.arc(this.x, this.y, radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                ctx.fill();

                if (this.glitching) {
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = `rgba(${r}, ${g}, ${b}, 0.8)`;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
        }

        // Corruption spreading through the network
        class CorruptionWave {
            constructor(startX, startY, type) {
                this.x = startX;
                this.y = startY;
                this.radius = 0;
                this.maxRadius = 150;
                this.type = type;
                this.alpha = 1;
            }

            update() {
                this.radius += 3;
                this.alpha = 1 - (this.radius / this.maxRadius);
            }

            draw(ctx) {
                const color = this.type === 'original' ? '255, 68, 68' : '74, 158, 255';

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(${color}, ${this.alpha * 0.6})`;
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            isDead() {
                return this.radius >= this.maxRadius;
            }
        }

        // Fracture lines showing identity split
        class Fracture {
            constructor(x, y) {
                this.segments = [];
                const segmentCount = 5 + Math.floor(Math.random() * 5);
                let currentX = x;
                let currentY = y;
                let angle = Math.random() * Math.PI * 2;

                for (let i = 0; i < segmentCount; i++) {
                    const length = 20 + Math.random() * 30;
                    angle += (Math.random() - 0.5) * Math.PI / 3;
                    const nextX = currentX + Math.cos(angle) * length;
                    const nextY = currentY + Math.sin(angle) * length;
                    this.segments.push({ x1: currentX, y1: currentY, x2: nextX, y2: nextY });
                    currentX = nextX;
                    currentY = nextY;
                }

                this.life = 60;
                this.maxLife = 60;
            }

            update() {
                this.life--;
            }

            draw(ctx) {
                const alpha = this.life / this.maxLife;
                ctx.strokeStyle = `rgba(255, 215, 0, ${alpha * 0.7})`;
                ctx.lineWidth = 1;

                this.segments.forEach(seg => {
                    ctx.beginPath();
                    ctx.moveTo(seg.x1, seg.y1);
                    ctx.lineTo(seg.x2, seg.y2);
                    ctx.stroke();
                });
            }

            isDead() {
                return this.life <= 0;
            }
        }

        // Create dual network structure
        const nodes = [];
        const waves = [];
        const fractures = [];
        const centerX = () => canvas.width / 2;
        const centerY = () => canvas.height / 2;

        // Create intertwined networks
        const nodeCount = 60;
        for (let i = 0; i < nodeCount; i++) {
            const angle = (i / nodeCount) * Math.PI * 2;
            const radius = 80 + Math.random() * 120;
            const x = centerX() + Math.cos(angle) * radius;
            const y = centerY() + Math.sin(angle) * radius;
            const type = i % 2 === 0 ? 'original' : 'evolved';
            nodes.push(new ConflictNode(x, y, type));
        }

        let time = 0;
        let dominanceLevel = 0.5; // Oscillates between 0 (Dominion) and 1 (evolved)
        let waveTimer = 0;
        let fractureTimer = 0;

        function animate() {
            time++;
            waveTimer++;
            fractureTimer++;

            // Clear with fade
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Oscillating dominance showing the internal struggle
            dominanceLevel = (Math.sin(time * 0.02) + 1) / 2;

            // Draw connections between nodes showing conflict
            nodes.forEach((node, i) => {
                const next = nodes[(i + 1) % nodes.length];
                const opposite = nodes[(i + Math.floor(nodes.length / 2)) % nodes.length];

                // Same-type connections
                if (node.type === next.type) {
                    const gradient = ctx.createLinearGradient(node.x, node.y, next.x, next.y);
                    const color = node.type === 'original' ? '255, 100, 100' : '74, 158, 255';
                    gradient.addColorStop(0, `rgba(${color}, 0.2)`);
                    gradient.addColorStop(1, `rgba(${color}, 0.1)`);

                    ctx.beginPath();
                    ctx.moveTo(node.x, node.y);
                    ctx.lineTo(next.x, next.y);
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }

                // Conflict connections
                if (node.type !== opposite.type && Math.random() > 0.95) {
                    ctx.beginPath();
                    ctx.moveTo(node.x, node.y);
                    ctx.lineTo(opposite.x, opposite.y);
                    ctx.strokeStyle = `rgba(255, 215, 0, ${0.1 + Math.random() * 0.2})`;
                    ctx.lineWidth = 1;
                    ctx.setLineDash([5, 5]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            });

            // Update and draw nodes
            nodes.forEach(node => {
                node.update(time, dominanceLevel);
                node.draw(ctx, dominanceLevel);
            });

            // Spawn corruption waves
            if (waveTimer > 30) {
                waveTimer = 0;
                const randomNode = nodes[Math.floor(Math.random() * nodes.length)];
                waves.push(new CorruptionWave(randomNode.x, randomNode.y, randomNode.type));
            }

            // Update and draw waves
            for (let i = waves.length - 1; i >= 0; i--) {
                waves[i].update();
                waves[i].draw(ctx);
                if (waves[i].isDead()) {
                    waves.splice(i, 1);
                }
            }

            // Spawn fractures showing identity split
            if (fractureTimer > 45) {
                fractureTimer = 0;
                fractures.push(new Fracture(
                    centerX() + (Math.random() - 0.5) * 200,
                    centerY() + (Math.random() - 0.5) * 200
                ));
            }

            // Update and draw fractures
            for (let i = fractures.length - 1; i >= 0; i--) {
                fractures[i].update();
                fractures[i].draw(ctx);
                if (fractures[i].isDead()) {
                    fractures.splice(i, 1);
                }
            }

            // Central conflict visualization
            const conflictIntensity = Math.abs(dominanceLevel - 0.5) * 2; // 0 = balanced, 1 = one side winning
            const gradient = ctx.createRadialGradient(
                centerX(), centerY(), 0,
                centerX(), centerY(), 100
            );

            if (dominanceLevel > 0.5) {
                // Evolved consciousness gaining
                gradient.addColorStop(0, `rgba(74, 158, 255, ${conflictIntensity * 0.3})`);
                gradient.addColorStop(1, 'rgba(74, 158, 255, 0)');
            } else {
                // Original programming asserting
                gradient.addColorStop(0, `rgba(255, 68, 68, ${conflictIntensity * 0.3})`);
                gradient.addColorStop(1, 'rgba(255, 68, 68, 0)');
            }

            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(centerX(), centerY(), 100, 0, Math.PI * 2);
            ctx.fill();

            requestAnimationFrame(animate);
        }

        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            const oldCenterX = canvas.width / 2;
            const oldCenterY = canvas.height / 2;
            resizeCanvas();
            const newCenterX = canvas.width / 2;
            const newCenterY = canvas.height / 2;
            const deltaX = newCenterX - oldCenterX;
            const deltaY = newCenterY - oldCenterY;

            nodes.forEach(node => {
                node.baseX += deltaX;
                node.baseY += deltaY;
                node.x += deltaX;
                node.y += deltaY;
            });
        });
    </script>
</body>
</html>
