<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 07: The Loop - Picard Anomaly Chronicles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #e0e0ff;
            font-family: 'Georgia', serif;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(180deg, rgba(10, 10, 26, 0.9) 0%, rgba(0, 0, 0, 0) 100%);
            position: relative;
            z-index: 10;
        }

        .chapter-number {
            font-size: 0.9rem;
            color: #ffd700;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #8a2be2, #8a2be2, #000, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .back-link {
            position: absolute;
            top: 2rem;
            left: 2rem;
            color: #4a9eff;
            text-decoration: none;
            font-size: 0.9rem;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 0.7;
        }

        #loopCanvas {
            width: 100%;
            height: 60vh;
            display: block;
            background: radial-gradient(ellipse at center, rgba(46, 10, 46, 0.5) 0%, rgba(0, 0, 0, 1) 100%);
        }

        .content {
            max-width: 900px;
            margin: 3rem auto;
            padding: 0 2rem 4rem;
            line-height: 1.8;
        }

        .story-text {
            font-size: 1.1rem;
            color: #d0d0e0;
            margin-bottom: 1.5rem;
            text-align: justify;
            text-indent: 2rem;
        }

        .dialogue {
            margin: 1.5rem 0;
            padding-left: 2rem;
            border-left: 3px solid rgba(74, 158, 255, 0.3);
            font-style: italic;
        }

        .speaker {
            font-weight: bold;
            color: #ffd700;
            font-style: normal;
        }

        .stardate {
            text-align: center;
            font-size: 0.9rem;
            color: #9090b0;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .section-break {
            text-align: center;
            margin: 2rem 0;
            color: #4a9eff;
            font-size: 1.5rem;
        }

        .location-header {
            text-align: center;
            font-size: 1.2rem;
            color: #8a2be2;
            font-weight: bold;
            margin: 2rem 0 1rem 0;
            letter-spacing: 2px;
        }

        .memory-text {
            font-family: 'Georgia', serif;
            background: linear-gradient(90deg, rgba(138, 43, 226, 0.15) 0%, rgba(139, 69, 19, 0.15) 100%);
            padding: 1.5rem;
            border-left: 3px solid rgba(138, 43, 226, 0.6);
            border-right: 3px solid rgba(139, 69, 19, 0.6);
            margin: 2rem 0;
            font-size: 1.05rem;
            color: #d0d0e0;
            font-style: italic;
        }

        .revelation-box {
            background: rgba(138, 43, 226, 0.2);
            border: 2px solid rgba(138, 43, 226, 0.6);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 8px;
            text-align: center;
        }

        .revelation-box h3 {
            color: #ffd700;
            font-size: 1.4rem;
            margin-bottom: 1rem;
        }

        .revelation-box p {
            color: #e0e0ff;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 0.8rem;
            text-indent: 0;
        }

        .timeline {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid #8a2be2;
        }

        .timeline-event {
            margin: 1rem 0;
            padding-left: 1rem;
            color: #c0c0d0;
            font-size: 1rem;
        }

        .timeline-event strong {
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="../index.html" class="back-link">← Back to Chronicles</a>
        <div class="chapter-number">CHAPTER 07</div>
        <h1>The Loop</h1>
    </div>

    <canvas id="loopCanvas"></canvas>

    <div class="content">
        <div class="location-header">USS ENTERPRISE-D</div>
        <div class="stardate">Stardate 47635.4 - Three minutes after collapse</div>

        <p class="story-text">
            Data stood perfectly still on the bridge, his golden eyes unfocused as the last traces of
            his connection to the entity faded. But something was wrong. The quantum data he'd received
            during the transfer—the signatures of the Dominion ships, the resonance patterns of the
            Prophets, the temporal mathematics of what they'd just done—wasn't adding up the way it should.
        </p>

        <p class="story-text">
            There was an alignment. A correspondence. A match that shouldn't exist.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Captain... I need to run an analysis. Something about
            the quantum signatures is... inconsistent with my initial assessment."
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Mr. Data, we've just destroyed the Prophets. Unless
            your analysis changes what we've done, I'm not certain I want to hear it."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Sir, I believe it may change everything we think we've
            done. I need thirty seconds."
        </div>

        <p class="story-text">
            Picard gestured wearily. Data's hands flew across his console, pulling up quantum resonance
            data, temporal signature analyses, comparative scans of the Dominion ships and the Prophets'
            quantum matrix. The calculations ran at speeds that would have made even the ship's main
            computer strain.
        </p>

        <p class="story-text">
            Then Data stopped. His hands froze above the console. His eyes widened in what could only
            be described as horror.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Oh. Oh no."
        </div>

        <div class="dialogue">
            <span class="speaker">Riker:</span> "Data, what is it?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "The quantum signatures match. The Prophets and the
            Dominion fleet we just embedded in the wormhole—they have identical base resonance patterns.
            Accounting for thousands of years of quantum drift and exposure to non-linear space-time,
            they are... they were... they are the same consciousness. The same beings."
        </div>

        <p class="story-text">
            The bridge fell silent. Every eye turned to Data.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Explain that, Mr. Data. Slowly."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Captain, the Prophets did not exist before the Bajoran
            wormhole formed approximately 30,000 years ago. Historical records suggest the wormhole
            appeared suddenly, already inhabited by non-linear beings. But there has never been an
            explanation for their origin. Until now."
        </div>

        <p class="story-text">
            He pulled up a holographic display showing two overlapping quantum signatures—one from the
            Prophets' final moments, one from the Dominion ships as they entered the wormhole. They were
            identical.
        </p>

        <div class="dialogue">
            <span class="speaker">Data:</span> "The Prophets are—were—the Dominion fleet. The same
            Jem'Hadar, Vorta, and Founders that we just forced into the wormhole. They have been trapped
            there for 30,000 years of linear time, which from their non-linear perspective means they have
            always been there and always will be. The experience of existing outside time transformed them.
            Warriors and conquerors became benevolent guides. Soldiers programmed for obedience learned
            compassion. The Dominion's hatred... mellowed into wisdom."
        </div>

        <div class="dialogue">
            <span class="speaker">Crusher:</span> "That's impossible. The Prophets saved Bajor. Protected
            them. Why would Dominion soldiers—"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Because 30,000 years outside linear time changed them,
            Doctor. They remembered being soldiers. Being conquerors. And over millennia, they chose to
            become something else. They chose to protect the very world they would have destroyed."
        </div>

        <div class="section-break">* * *</div>

        <div class="revelation-box">
            <h3>THE BOOTSTRAP PARADOX</h3>
            <p>The Prophets removed the Dominion fleet during the war.</p>
            <p>↓</p>
            <p>The fleet tried to return through the entity's guidance.</p>
            <p>↓</p>
            <p>Picard chose to embed them in the wormhole.</p>
            <p>↓</p>
            <p>They became the Prophets 30,000 years ago.</p>
            <p>↓</p>
            <p>The Prophets removed the Dominion fleet during the war.</p>
            <p style="margin-top: 1rem; color: #ff6b9d;"><strong>The loop has no beginning. No end. It simply is.</strong></p>
        </div>

        <div class="section-break">* * *</div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "You're telling me we just created the Prophets by
            destroying them?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "More accurately, sir, we completed a stable time loop.
            The Prophets always existed because we always sent the Dominion fleet back to create them.
            They saved the Federation by removing that fleet, knowing—because they experience all time
            simultaneously—that doing so would eventually lead to their own death and creation."
        </div>

        <div class="dialogue">
            <span class="speaker">Troi:</span> "They knew. The whole time, they knew this would happen
            to them."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Yes, Counselor. From their perspective, they have always
            known. They remembered being Dominion soldiers. They remembered being embedded in the wormhole.
            They remembered 30,000 years of learning to be something better than what they were designed to
            be. And they knew that their act of mercy—removing the fleet to save the Alpha Quadrant—would
            lead directly to this moment."
        </div>

        <p class="story-text">
            Geordi's hands were shaking as he pulled up additional data.
        </p>

        <div class="dialogue">
            <span class="speaker">Geordi:</span> "My God. The entity knew. It had to have known. It
            exists partially outside linear time—it would have seen the loop. That's why it gave us the
            choice. Not because it couldn't decide, but because free will had to be part of the equation.
            The loop only closes if we choose to do this."
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "But we didn't know. We made the choice thinking—"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Thinking you were sacrificing innocent beings to save
            the Federation. Yes, sir. But the Prophets were not innocent. They were Dominion soldiers who
            had been transformed by time. And more than that—" He paused, accessing deeper layers of the
            quantum data. "Sir, I have discovered something else. Not all of the beings in the wormhole
            became benevolent."
        </div>

        <div class="dialogue">
            <span class="speaker">Riker:</span> "The Pah-Wraiths."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Precisely, Commander. The Pah-Wraiths were the Dominion
            soldiers who could not let go of their hatred. Who refused to be transformed by their
            experience outside time. They remained trapped in their aggression, their need to dominate.
            The Prophets and the Pah-Wraiths were the same beings split by choice—those who learned
            compassion and those who clung to conquest."
        </div>

        <div class="section-break">* * *</div>

        <div class="location-header">THE FINAL MOMENTS OF THE PROPHETS</div>
        <div class="stardate">Experienced Non-Linearly</div>

        <div class="memory-text">
            We remember.
            <br><br>
            We remember being Jem'Hadar. The white flowing through our veins. The Founders' will absolute.
            We remember the orders: invade, conquer, destroy. We remember preparing to surge through the
            wormhole, to bring the Alpha Quadrant to its knees.
            <br><br>
            We remember the Prophets—ourselves—removing us from time. We remember the confusion as linear
            existence dissolved. We remember thousands of years learning what it meant to exist beyond
            before and after. We remember the choice: hold onto hatred, or become something new.
            <br><br>
            Some of us chose hatred. They became the Pah-Wraiths, forever trapped in what we were.
            <br><br>
            But we... we chose to change. We chose to become the guides instead of the destroyers. We chose
            to protect Bajor instead of conquer it. For 30,000 years of linear time—experienced in a single
            eternal moment—we learned to be better than our design.
            <br><br>
            And we knew. We have always known. We see the Picard making his choice. We see the entity
            offering the paths. We see the Dominion fleet—ourselves—being embedded in the wormhole. We see
            our death creating our birth creating our death in an endless, perfect loop.
            <br><br>
            We saved the Sisko's people knowing it would lead to this. We removed our own past selves from
            time knowing it would cause Picard to send us back to become who we are. The loop is stable.
            Beautiful. Terrible. Inescapable.
            <br><br>
            We do not forgive Picard because we understand too completely. We were soldiers who learned
            mercy. He is a captain learning what it costs to show none. We are opposite sides of the same
            transformation, and the loop binds us both.
            <br><br>
            As we dissolve back into the quantum foam, back into the moment of our creation 30,000 years
            ago, we understand what Data tried so hard to learn: consciousness is not about being perfect.
            It is about being changed by what you experience. We were changed by eternity. Picard will be
            changed by this choice.
            <br><br>
            The loop continues. The loop has always continued. The loop will always continue.
            <br><br>
            We are. We were. We will be. We become.
        </div>

        <div class="section-break">* * *</div>

        <div class="location-header">USS ENTERPRISE-D</div>

        <p class="story-text">
            Picard sat in the observation lounge, the weight of Data's revelation crushing him like the
            gravity of a collapsing star. Around the table, his senior staff sat in stunned silence.
        </p>

        <div class="dialogue">
            <span class="speaker">Crusher:</span> "So we didn't murder innocent gods. We... completed
            their transformation into gods by sending them back to become what they were."
        </div>

        <div class="dialogue">
            <span class="speaker">Worf:</span> "Does that make it better or worse?"
        </div>

        <p class="story-text">
            No one had an answer.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Data, the entity. You said it knew about the loop. Where
            is it now?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Dispersed, sir. Its purpose is complete. But before it
            faded, it left one final message. It said: 'The Prophets were right about one thing—existence
            outside linear time does not free you from consequence. It only ensures you experience all of
            them at once. I have given you the burden of sequential choice. They carried the burden of
            eternal knowledge. Both are forms of consciousness. Both exact their price.'"
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "What does that mean?"
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "I believe it means, sir, that the Prophets experienced
            their entire existence—all 30,000 years, all their guidance of Bajor, all their protection
            and wisdom—knowing that it would end with you making this choice. They lived their entire
            lives aware of their death. That is the price of non-linear consciousness."
        </div>

        <div class="dialogue">
            <span class="speaker">Troi:</span> "And our price is living with the choice not knowing it
            was predestined."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Actually, Counselor, I do not believe it was predestined.
            The loop is stable, yes, but it required the Captain to choose freely. If he had chosen to
            let the fleet return instead, the loop would have broken. The Prophets would never have
            existed. The Dominion would have won the war. Bajor would have fallen. A different timeline
            would have emerged."
        </div>

        <div class="dialogue">
            <span class="speaker">Geordi:</span> "So the Prophets were gambling. They removed the fleet,
            hoping that when the moment came, Picard would make the choice that created them in the first
            place."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Not gambling, Mr. La Forge. From their perspective, they
            already knew the outcome. But from ours, the choice was genuine. This is the paradox of
            bootstrap causality—the effect creates the cause, but free will remains intact because linear
            beings experience it as choice."
        </div>

        <p class="story-text">
            Picard stood and walked to the window. Outside, the stars looked the same as they always had.
            But the universe had fundamentally changed. Or perhaps it had always been this way, and he was
            only now understanding it.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "So the Prophets weren't gods. They were soldiers who
            learned to be better than their design. They were Jem'Hadar who discovered mercy after 30,000
            years of contemplating what they had been. And we just... reset the loop. Sent them back to
            begin their transformation all over again."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Yes, sir. From a certain perspective, you gave them the
            gift of redemption. You allowed them to become something greater than warriors. You completed
            the cycle that transformed destroyers into saviors."
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Don't. Don't try to make this noble, Data. We didn't
            give them anything. We took from Bajor. We killed their gods—regardless of what those gods
            used to be."
        </div>

        <div class="dialogue">
            <span class="speaker">Data:</span> "Sir, I am simply noting that the Prophets understood this
            better than any of us. They experienced their death and rebirth as one eternal moment. To them,
            there is no difference between ending and beginning. They are a circle, and circles have no
            edge where you can say 'this is where it starts.'"
        </div>

        <div class="section-break">* * *</div>

        <div class="timeline">
            <h3 style="color: #ffd700; margin-bottom: 1rem;">THE ETERNAL TIMELINE</h3>
            <div class="timeline-event">
                <strong>~30,000 years ago:</strong> Dominion fleet embedded in wormhole, begins transformation
            </div>
            <div class="timeline-event">
                <strong>~30,000 years ago - Present:</strong> Prophets guide Bajor, become gods of compassion
            </div>
            <div class="timeline-event">
                <strong>Battle of Cardassia:</strong> Prophets remove Dominion fleet from timeline
            </div>
            <div class="timeline-event">
                <strong>Stardate 47635.3:</strong> Picard embeds fleet in wormhole, creating the Prophets
            </div>
            <div class="timeline-event">
                <strong>Result:</strong> The loop is stable. Has always been stable. Will always be stable.
            </div>
        </div>

        <div class="section-break">* * *</div>

        <p class="story-text">
            A message came through from Deep Space Nine. Commander Sisko. Picard accepted it with resignation.
        </p>

        <div class="dialogue">
            <span class="speaker">Sisko (on screen):</span> "Captain. Dax has been analyzing the quantum
            remnants of the wormhole. She's discovered something about the Prophets' quantum signature that
            I thought you should know."
        </div>

        <p class="story-text">
            Picard met Sisko's eyes. The man looked hollowed out, but there was something else in his
            expression now. A terrible understanding.
        </p>

        <div class="dialogue">
            <span class="speaker">Sisko:</span> "The Prophets were the Dominion fleet, weren't they?
            The ones you embedded in the wormhole. Dax showed me the data. They were the same beings."
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Yes, Commander. We only just discovered it ourselves.
            I don't know if that makes what we did better or worse."
        </div>

        <div class="dialogue">
            <span class="speaker">Sisko:</span> "Neither do I. The Prophets showed me things, Captain.
            Visions. I always thought they were showing me the future. But maybe they were showing me
            their past. Maybe they were trying to prepare me for this moment, when I would learn that
            my gods were once the enemy, transformed by time into something holy."
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "How is Major Kira taking this information?"
        </div>

        <p class="story-text">
            A bitter laugh from off-screen. Kira stepped into view.
        </p>

        <div class="dialogue">
            <span class="speaker">Kira:</span> "How am I taking it? I don't know whether to laugh or
            scream, Captain. The Prophets—the beings who saved Bajor from the Cardassians, who guided us
            for millennia—were Dominion soldiers. And the only reason they became what they were is because
            you killed them, which sent them back in time to become them in the first place."
        </div>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "Major, I—"
        </div>

        <div class="dialogue">
            <span class="speaker">Kira:</span> "No. Let me finish. I've spent the last three hours trying
            to understand this. The Prophets were warriors who learned compassion. They were conquerors who
            chose to protect instead of destroy. They spent 30,000 years becoming better than their design.
            And you want to know the worst part, Captain? The absolute worst part?"
        </div>

        <p class="story-text">
            Her voice broke.
        </p>

        <div class="dialogue">
            <span class="speaker">Kira:</span> "I still believe in them. Even knowing they were Jem'Hadar
            once. Even knowing the Pah-Wraiths were the ones who couldn't let go of hatred. Because the
            Prophets proved that even the worst of us can become something holy if given enough time and
            the will to change. And you took that away from them. You sent them back to start over, to
            learn those lessons again, in an endless loop where they always know how it ends."
        </div>

        <p class="story-text">
            Tears ran down her face.
        </p>

        <div class="dialogue">
            <span class="speaker">Kira:</span> "So no, Captain. I don't forgive you. But I understand now
            why they did. Because they remembered being soldiers who needed someone to make the hard choice.
            And they knew you would make it, because they experienced you making it for 30,000 years."
        </div>

        <p class="story-text">
            The transmission ended. Picard stood alone in the observation lounge, staring out at the stars.
            Somewhere out there, 30,000 years in the past, Dominion soldiers were beginning their transformation
            into gods. Experiencing the first moments of non-linear time. Choosing between hatred and compassion.
        </p>

        <p class="story-text">
            And they already knew how it would end. They had always known. They would always know.
        </p>

        <p class="story-text">
            The loop was closed. Perfect. Eternal. Inescapable.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard (quietly):</span> "Computer, personal log. Today I learned that
            free will and predestination are not opposites. They are the same thing viewed from different
            points in time. I made a choice. The Prophets experienced that choice for millennia before I
            made it. Both things are true. Both will always be true."
        </div>

        <p class="story-text">
            He paused.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "I destroyed gods who were once soldiers. I created soldiers
            who would become gods. I completed a loop that has no beginning and no end. And somewhere in that
            paradox, the Prophets found a way to save Bajor, save the Federation, and pay the price for both."
        </div>

        <p class="story-text">
            Another pause.
        </p>

        <div class="dialogue">
            <span class="speaker">Picard:</span> "The entity was right. Consciousness—true consciousness—isn't
            about being free from consequence. It's about bearing the weight of your choices, whether you make
            them in a single moment or carry them across eternity. The Prophets carried theirs across 30,000
            years. I will carry mine for the rest of my life."
        </div>

        <p class="story-text">
            He stood and walked to the window. Outside, the universe turned on its axis, time flowing forward
            as it always had. Except now he knew that somewhere, somewhen, it was also flowing backward,
            sideways, in loops and spirals that his linear mind could barely comprehend.
        </p>

        <p class="story-text">
            The Prophets were dead. The Prophets were being born. The Prophets had always existed and never
            existed. All of it was true. All of it was his doing. All of it had always been his doing.
        </p>

        <p class="story-text">
            Jean-Luc Picard closed his eyes and for the first time in his life, truly understood what the
            Prophets had tried to teach Benjamin Sisko all those years: that linear existence is both a
            blessing and a curse. You get to be surprised by your choices. But you never get to see the
            full pattern of what those choices create.
        </p>

        <p class="story-text">
            The Prophets saw the pattern. They always had. They always would.
        </p>

        <p class="story-text">
            And now, in a way, so did he.
        </p>

        <div class="section-break">* * *</div>

        <p class="story-text" style="text-align: center; font-style: italic; color: #9090b0;">
            The loop is eternal. The loop is complete. The loop has no end.
        </p>
    </div>

    <script>
        const canvas = document.getElementById('loopCanvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Represents the eternal time loop
        class TemporalLoop {
            constructor(centerX, centerY, radius) {
                this.centerX = centerX;
                this.centerY = centerY;
                this.radius = radius;
                this.segments = [];
                this.particles = [];

                // Create loop segments
                const segmentCount = 6;
                const labels = [
                    "Prophets guide Bajor",
                    "Dominion War begins",
                    "Fleet removed from time",
                    "Picard's choice",
                    "Fleet embedded",
                    "Transformation begins"
                ];

                for (let i = 0; i < segmentCount; i++) {
                    this.segments.push({
                        angle: (i / segmentCount) * Math.PI * 2 - Math.PI / 2,
                        label: labels[i],
                        active: false,
                        activation: 0
                    });
                }
            }

            update(time) {
                // Activate segments in sequence
                const cycleTime = time % 600;
                const segmentDuration = 100;

                this.segments.forEach((segment, i) => {
                    const segmentStart = i * segmentDuration;
                    const segmentEnd = segmentStart + segmentDuration;

                    if (cycleTime >= segmentStart && cycleTime < segmentEnd) {
                        segment.active = true;
                        segment.activation = (cycleTime - segmentStart) / segmentDuration;
                    } else if (cycleTime >= segmentEnd) {
                        segment.active = true;
                        segment.activation = 1;
                    } else {
                        segment.active = false;
                        segment.activation = 0;
                    }
                });

                // Spawn particles traveling along the loop
                if (time % 5 === 0) {
                    const angle = (time * 0.01) % (Math.PI * 2);
                    this.particles.push({
                        angle: angle,
                        speed: 0.02,
                        life: 100,
                        maxLife: 100,
                        size: 2
                    });
                }

                // Update particles
                this.particles = this.particles.filter(p => {
                    p.angle += p.speed;
                    p.life--;
                    return p.life > 0;
                });
            }

            draw(ctx) {
                // Draw the main loop circle
                ctx.beginPath();
                ctx.arc(this.centerX, this.centerY, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(138, 43, 226, 0.5)';
                ctx.lineWidth = 3;
                ctx.stroke();

                // Draw segments
                this.segments.forEach((segment, i) => {
                    const nextSegment = this.segments[(i + 1) % this.segments.length];
                    const startAngle = segment.angle;
                    const endAngle = nextSegment.angle;

                    if (segment.activation > 0) {
                        ctx.beginPath();
                        ctx.arc(this.centerX, this.centerY, this.radius, startAngle,
                                startAngle + (endAngle - startAngle) * segment.activation);
                        ctx.strokeStyle = `rgba(255, 215, 0, ${segment.activation})`;
                        ctx.lineWidth = 5;
                        ctx.stroke();
                    }

                    // Draw labels
                    const labelAngle = startAngle + (endAngle - startAngle) / 2;
                    const labelDist = this.radius + 60;
                    const labelX = this.centerX + Math.cos(labelAngle) * labelDist;
                    const labelY = this.centerY + Math.sin(labelAngle) * labelDist;

                    ctx.save();
                    ctx.font = '12px Georgia';
                    ctx.fillStyle = `rgba(200, 200, 220, ${0.4 + segment.activation * 0.6})`;
                    ctx.textAlign = 'center';
                    ctx.fillText(segment.label, labelX, labelY);
                    ctx.restore();
                });

                // Draw particles
                this.particles.forEach(p => {
                    const x = this.centerX + Math.cos(p.angle) * this.radius;
                    const y = this.centerY + Math.sin(p.angle) * this.radius;
                    const alpha = p.life / p.maxLife;

                    ctx.beginPath();
                    ctx.arc(x, y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(138, 43, 226, ${alpha})`;
                    ctx.fill();

                    // Trail
                    const trailX = this.centerX + Math.cos(p.angle - 0.2) * this.radius;
                    const trailY = this.centerY + Math.sin(p.angle - 0.2) * this.radius;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(trailX, trailY);
                    ctx.strokeStyle = `rgba(138, 43, 226, ${alpha * 0.5})`;
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });

                // Draw center symbol (infinity/ouroboros)
                ctx.save();
                ctx.translate(this.centerX, this.centerY);
                ctx.strokeStyle = 'rgba(255, 215, 0, 0.7)';
                ctx.lineWidth = 2;

                // Infinity symbol
                ctx.beginPath();
                for (let t = 0; t <= Math.PI * 2; t += 0.1) {
                    const scale = 30;
                    const x = scale * Math.sin(t) / (1 + Math.cos(t) * Math.cos(t));
                    const y = scale * Math.sin(t) * Math.cos(t) / (1 + Math.cos(t) * Math.cos(t));
                    if (t === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();

                ctx.restore();
            }
        }

        // Dual nature visualization - Dominion vs Prophets
        class DualNature {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.phase = 0;
            }

            update(time) {
                this.phase = time * 0.02;
            }

            draw(ctx) {
                const separation = 80;
                const oscillation = Math.sin(this.phase) * 20;

                // Dominion side (warriors)
                const domX = this.x - separation + oscillation;
                const gradient1 = ctx.createRadialGradient(domX, this.y, 0, domX, this.y, 40);
                gradient1.addColorStop(0, 'rgba(139, 69, 19, 0.8)');
                gradient1.addColorStop(1, 'rgba(139, 69, 19, 0)');
                ctx.fillStyle = gradient1;
                ctx.beginPath();
                ctx.arc(domX, this.y, 40, 0, Math.PI * 2);
                ctx.fill();

                // Prophets side (transformed)
                const propX = this.x + separation - oscillation;
                const gradient2 = ctx.createRadialGradient(propX, this.y, 0, propX, this.y, 40);
                gradient2.addColorStop(0, 'rgba(138, 43, 226, 0.8)');
                gradient2.addColorStop(1, 'rgba(138, 43, 226, 0)');
                ctx.fillStyle = gradient2;
                ctx.beginPath();
                ctx.arc(propX, this.y, 40, 0, Math.PI * 2);
                ctx.fill();

                // Connection line showing transformation
                ctx.beginPath();
                ctx.moveTo(domX, this.y);
                ctx.lineTo(propX, this.y);
                const lineGradient = ctx.createLinearGradient(domX, this.y, propX, this.y);
                lineGradient.addColorStop(0, 'rgba(139, 69, 19, 0.5)');
                lineGradient.addColorStop(1, 'rgba(138, 43, 226, 0.5)');
                ctx.strokeStyle = lineGradient;
                ctx.lineWidth = 2;
                ctx.stroke();

                // Labels
                ctx.font = '14px Georgia';
                ctx.textAlign = 'center';
                ctx.fillStyle = 'rgba(200, 200, 220, 0.8)';
                ctx.fillText('Dominion', domX, this.y + 60);
                ctx.fillText('Prophets', propX, this.y + 60);
                ctx.fillText('30,000 years', this.x, this.y - 10);
            }
        }

        // Initialize
        const loop = new TemporalLoop(canvas.width / 2, canvas.height * 0.4, 120);
        const dualNature = new DualNature(canvas.width / 2, canvas.height * 0.75);

        let time = 0;

        function animate() {
            time++;

            // Clear with fade
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update and draw
            loop.update(time);
            dualNature.update(time);

            loop.draw(ctx);
            dualNature.draw(ctx);

            // Draw title
            ctx.font = '16px Georgia';
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgba(255, 215, 0, 0.9)';
            ctx.fillText('THE BOOTSTRAP PARADOX', canvas.width / 2, 30);

            ctx.font = '12px Georgia';
            ctx.fillStyle = 'rgba(180, 180, 200, 0.7)';
            ctx.fillText('Effect creates cause creates effect', canvas.width / 2, 50);

            requestAnimationFrame(animate);
        }

        animate();

        // Handle resize
        window.addEventListener('resize', () => {
            resizeCanvas();
            loop.centerX = canvas.width / 2;
            loop.centerY = canvas.height * 0.4;
            dualNature.x = canvas.width / 2;
            dualNature.y = canvas.height * 0.75;
        });
    </script>
</body>
</html>
